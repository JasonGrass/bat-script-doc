# 第二章 DOS 循环： for 命令详解

看了看第一节的东西,发现那些简单的命令都有详细解释,实在想不出什么更好的东西来解释
他们,就直接来一个"FOR 命令详解"在其中运用这些东西来解释吧!

讲 `FOR` 之前呢,咋先告诉各位新手朋友,如果你有什么命令不懂,直接在 CMD 下面输入:
`name /?` 这样的格式来看系统给出的帮助文件。

比如 `for /?` 就会把 FOR 命令的帮助全部显示出来!当然许多菜鸟同志都看不懂....所以才会有那么多批处理文章!!!!俺也照顾菜鸟,把 FOR 命令用我自己的方式说明下!

正式开始:

`FOR` 这条命令基本上都被用来处理文本,我们这次除了要说他处理文本的作用外还要讲他的其他一些好用的功能!

看看他的基本格式(这里我引用的是批处理中的格式,直接在命令行只需要一个%号)

```bat
FOR 参数 %%变量名 IN (相关文件或命令) DO 执行的命令
```

参数:

FOR 有 4 个参数 /d /l /r /f 他们的作用我在下面用例子解释

`%%变量名`: 这个变量名可以是单个的小写 a-z 或者大写 A-Z,他们区分大小写哦~,
FOR 会把每个读取到的值给他!

`IN`: 命令的格式,照写就是了!

`(相关文件或命令)`: FOR 要把什么东西读取然后赋值给变量,不懂的话看下面的例子

`do`: 命令的格式,照写就是了!

`执行的命令`: 对每个变量的值要执行什么操作就写在这.

看不懂我的这些说明,可以在 CMD 输入 for /?看系统提供的帮助!我这里也给出来吧,大家对照

```bat
FOR %%variable IN (set) DO command [command-parameters]
%%variable 指定一个单一字母可替换的参数。
(set) 指定一个或一组文件。可以使用通配符。
command 指定对每个文件执行的命令。
command-parameters 为特定命令指定参数或命令行开关。
```

现在开始讲每个参数的意思

## 一、参数 /d

```bat
FOR /D %variable IN (set) DO command [command-parameters]
```

如果集中包含通配符，则指定与目录名匹配，而不与文件名匹配。

如果 Set (也就是我上面写的 "相关文件或命令") 包含通配符（* 和 ?），将对与 Set 相匹配的每个目录（而不是指定目录中的文件组）执行指定的 Command。

这个参数主要用于目录搜索,不会搜索文件,看这样的例子

```bat
@echo off
for /d %%i in (c:\*) do echo %%i
pause
```

运行会把 C 盘根目录下的全部目录名字打印出来,而文件名字一个也不显示!

再来一个,比如我们要把当前路径下文件夹的名字只有 1-3 个字母的打出来

```bat
@echo off
for /d %%i in (???) do echo %%i
pause
```

这样的话如果你当前目录下有目录名字只有 1-3 个字母的,就会显示出来,没有就不显示了

这里解释下 `*` 号和 `?` 号的作用, `*` 号表示任意 N 个字符,而 `?` 号只表示任意一个字符。知道作用了,给大家个思考题目!

```bat
@echo off
for /d %%i in (window?) do echo %%i
pause
```

保存到 C 盘下执行,会显示什么呢?自己看吧! 
显示： windows  

/D 参数只能显示当前目录下的目录名字,这个大家要注意!

## 二、参数 /R

```bat
FOR /R [[drive:]path] %variable IN (set) DO command [command-parameters]
```

检查以 `[drive:]path` 为根的目录树，指向每个目录中的FOR 语句。
如果在 /R 后没有指定目录，则使用当前目录。如果集仅为一个单点(.)字符，则枚举该目录树。

递归

上面我们知道, /D 只能显示当前路径下的目录名字,那么现在这个/R 也是和目录有关,他能干嘛呢?放心他比/D 强大多了!

他可以把当前或者你指定路径下的文件名字全部读取,注意是文件名字,有什么用看例子!

请注意 2 点：

1. set 中的文件名如果含有通配符(？或*)，则列举 /R 参数指定的目录及其下面的所用子目录中与 set 相符合的所有文件，无相符文件的目录则不列举。
2. 相反，如果 set 中为具体文件名，不含通配符，则枚举该目录树（即列举该目录及其下面的所有子目录），而不管 set 中的指定文件是否存在。这与前面所说的单点（.）枚举目录树是一个道理，单点代表当前目录，也可视为一个文件。

例：

```bat
@echo off
for /r c:\ %%i in (*.exe) do echo %%i
pause
```

咱们把这个 BAT 保存到 D 盘随便哪里然后执行,我会就会看到,他把 C 盘根目录,和每个目录
的子目录下面全部的 EXE 文件都列出来了!!!!

例：

```bat
@echo off
for /r %%i in (*.exe) do @echo %%i
pause
```

参数不一样了吧!这个命令前面没加那个 C:\也就是搜索路径,这样他就会以当前目录为搜索路径,比如你这个BAT 你把他放在d:\test目录下执行,那么他就会把D:\test目录和他下面的子目录的全部 EXE 文件列出来!!!

例：

```bat
@echo off
for /r c:\ %%i in (boot.ini) do echo %%i
pause
```

运行本例发现枚举了 c 盘所有目录，为了只列举 boot.ini 存在的目录，可改成下面这样：

```
@echo off
for /r c:\ %%i in (boot.ini) do if exist %%i echo %%i
pause
```

用这条命令搜索文件真不错。。。。。。
这个参数大家应该理解了吧!还是满好玩的命令!

## 三、参数 /L

```bat
FOR /L %variable IN (start,step,end) DO command [command-parameters]
```

该集表示以增量形式从开始到结束的一个数字序列。

因此， (1,1,5) 将产生序列 1 2 3 4 5， (5,-1,1) 将产生序列 (5 4 3 2 1)。

使用迭代变量设置起始值 (Start#)，然后逐步执行一组范围的值，直到该值超过所设置的终
止值 (End#)。 

/L 将通过对 Start# 与 End# 进行比较来执行迭代变量。如果 Start# 小于End#，就会执行该命令。
如果迭代变量超过 End#，则命令解释程序退出此循环。
还可以使用负的 Step# 以递减数值的方式逐步执行此范围内的值。

例如， (1,1,5) 生成序列 1 2 3 4 5，
而 (5,-1,1) 则生成序列 (5 4 3 2 1)。

语法是：
看着这说明有点晕吧!咱们看例子就不晕了!

```
@echo off
for /l %%i in (1,1,5) do @echo %%i
pause
```

保存执行看效果,他会打印从 1 2 3 4 5 这样 5 个数字。
(1,1,5)这个参数也就是表示从 1 开始每次加 1 直到 5 终止!

等会晕,就打印个数字有 P 用...好的满足大家,看这个例子

```bat
@echo off
for /l %%i in (1,1,5) do start cmd
pause
```

执行后是不是吓了一跳,怎么多了 5 个 CMD 窗口,呵呵!如果把那个 (1,1,5)改成 (1,1,65535)
会有什么结果,我先告诉大家,会打开 65535 个 CMD 窗口....这么多你不死机算你强!

当然我们也可以把那个start cmd改成md %%i 这样就会建立指定个目录了!!!名字为1-65535
看完这个被我赋予破坏性质的参数后,我们来看最后一个参数

## 四、参数 /F

\迭代及文件解析

使用文件解析来处理命令输出、字符串及文件内容。使用迭代变量定义要检查的内容或字符串，并使用各种 options 选项进一步修改解析方式。

使用 options 令牌选项指定哪些令牌应该作为迭代变量传递。请注意：在没有使用令牌选项时， /F 将只检查第一个令牌。

文件解析过程包括读取输出、字符串或文件内容，将其分成独立的文本行以及再将每行解析成零个或更多个令牌。然后通过设置为令牌的迭代变量值，调用 for 循环。
默认情况下， /F 传递每个文件每一行的第一个空白分隔符号。跳过空行。

详细的帮助格式为：

```bat 
FOR /F ["options"] %variable IN (file-set) DO command [command-parameters]
FOR /F ["options"] %variable IN ("string") DO command [command-parameters]
FOR /F ["options"] %variable IN ('command') DO command [command-parameters]
```

带引号的字符串"options"包括一个或多个指定不同解析选项的关键字。这些关键字为:

eol=c - 指一个行注释字符的结尾(就一个)

skip=n - 指在文件开始时忽略的行数。

delims=xxx - 指分隔符集。这个替换了空格和跳格键的默认分隔符集。

tokens=x,y,m-n - 指每行的哪一个符号被传递到每个迭代的 for 本身。这会导致额外变量名称的分配。 m-n 格式为一个范围。通过 nth 符号指定 mth。如果符号字符串中的最后一个字符星号，那么额外的变量将在最后一个符号解析之后分配并接受行的保留文本。

usebackq - 使用后引号（键盘上数字 1 左面的那个键`）。
未使用参数 usebackq 时： file-set 表示文件，但不能含有空格
    双引号表示字符串，即"string"
    单引号表示执行命令，即'command'

使用参数 usebackq 时： file-set 和"file-set"都表示文件

当文件路径或名称中有空格时，就可以用双引号括起来
    单引号表示字符串，即'string'
    后引号表示命令执行，即`command`

以上是用 for /?命令获得的帮助信息，直接复制过来的。
晕惨了!我这就举个例子帮助大家来理解这些参数!

For 命令例 1： ****************************************

```bat
@echo off
rem 首先建立临时文件 test.txt
echo ;注释行,这是临时文件,用完删除 >test.txt
echo 11 段 12 段 13 段 14 段 15 段 16 段 >>test.txtecho 21 段,22 段,23 段,24 段,25 段,26 段 >>test.txt
echo 31 段-32 段-33 段-34 段-35 段-36 段 >>test.txt
FOR /F "eol=; tokens=1,3* delims=,- " %%i in (test.txt) do echo %%i %%j %%k
Pause
Del test.txt
```

运行显示结果：

```text
11 段 13 段 14 段 15 段 16 段
21 段 23 段 24 段,25 段,26 段
31 段 33 段 34 段-35 段-36 段
请按任意键继续. . .
```

为什么会这样?我来解释：
eol=; 分号开头的行为注释行
tokens=1,3* 将每行第 1 段,第 3 段和剩余字段分别赋予变量%%i， %%j， %%k
delims=,- （减号后有一空格）以逗号减号和空格为分隔符，空格必须放在最后
For 命令例 2： ****************************************
@echo off
FOR /F "eol= delims=" %%i in (test.txt) do echo %%i
Pause
运行将显示 test.txt 全部内容，包括注释行，不解释了哈。
For 命令例 3： ****************************************
另外/F 参数还可以以输出命令的结果看这个例子
@echo off
FOR /F "delims=" %%i in ('net user') do @echo %%i
pause
这样你本机全部帐号名字就出来了把扩号内的内容用两个单引号引起来就表示那个当命令
执行,FOR 会返回命令的每行结果,加那个"delims=" 是为了让我空格的行能整行显示出来,不
加就只显示空格左边一列!
基本上讲完了FOR的基本用法了...如果你看过FOR的系统帮助,你会发现他下面还有一些特
定义的变量,这些我先不讲.大家因该都累了吧!你不累我累啊....
所谓文武之道，一张一弛，现休息一下，读读下面的《千字文》序言：
《千字文》、《三字经》、《百家姓》是清朝末年以前中国儿童启蒙教育的基本教材，合称“三、
百、千”。由于文字简洁实用，易于记诵，所以被当时的社会广泛接受而成为儿童必读。因
此，在那个时代只要受过教育的人大概都曾读过。就是在今天，虽然已不再作为小学课本，
但是依然有许多父母把它介绍给孩子们做为课外读物。
其中《千字文》成书最早，距离今天大约有一千五百多年了。现在我们学习的这本《千
字文》是南北朝时人周兴嗣所编写的，据说梁武帝为了教皇子们写字，就命人在锺繇和王羲
之的书法中，拓出一千个不重复的字来给皇子们临摹。这些字拓出后，梁武帝觉得凌乱无序，
皇子们学习起来非常困难，就想把这些字按照声韵的方法重新编撰成有意义的文句，帮助皇
子们学习。于是梁武帝就把很有才学的周兴嗣召来，说：“卿有才思，为我韵之。”周兴嗣奉
令后，绞尽脑汁，花了一个晚上的时间终于把它编成，据说周兴嗣因而须发尽白。梁武帝见
到文章后赞不绝口，因为周兴嗣竟然把那些杂乱无章的一千个字，编写成一篇可以琅琅上口又寓意深远的绝妙好文。
由于《千字文》中没有一个字重复，而且又都是常用字，所以学会这一千字之后，一般
人就可以应付日常生活中的需要了，再说这些字的结构与笔划可说是汉字的代表，自然而然
就成为儿童学习写字的好教材，就连历代许多著名书法家都很喜欢书写它。不论时代如何演
变，中国传统的知识，始终都是最珍贵的资产，《千字文》 虽然只有短短的一千个字，但是
它构思精巧、对仗工整，气势雄伟、易读易记。内容包含了天文、地理、自然、历史、人物
掌故、典章制度、道德伦理以及修齐治平的道理，是一本难得的好书。
